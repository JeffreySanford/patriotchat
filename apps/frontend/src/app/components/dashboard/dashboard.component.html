<div class="dashboard-container">
  <!-- Song Length Selection Dialog -->
  <app-song-length-dialog
    #songLengthDialog
    (selected)="onSongLengthSelected($event)"
    (cancelled)="onSongLengthDialogCancelled()"
  >
  </app-song-length-dialog>

  <div class="chat-panel">
    <div *ngIf="availableModels.length" class="model-selector">
      <div class="model-selector__label">Model</div>
      <div class="model-selector__chips">
        <button
          *ngFor="let model of availableModels"
          type="button"
          class="model-chip"
          (click)="selectModel(model.id)"
          [class.selected]="model.id === selectedModel"
          [attr.aria-pressed]="model.id === selectedModel"
        >
          <span class="model-chip__name">{{ model.name }}</span>
          <small *ngIf="model.description" class="model-chip__description">
            {{ model.description }}
          </small>
        </button>
      </div>
    </div>
    <div class="messages" #messagesContainer>
      <div
        *ngFor="let msg of messages"
        [class.user]="msg.role === 'user'"
        class="message"
      >
        <div class="message-content">
          <div *ngIf="msg.isSong" class="song-container">
            <div class="song-header">
              <h3 class="song-title">ðŸŽµ {{ msg.title }}</h3>
              <p class="song-genre">{{ msg.genre }}</p>
            </div>
            <div class="song-lyrics">
              <pre>{{ msg.lyrics }}</pre>
            </div>
          </div>
          <div *ngIf="!msg.isSong">
            {{ msg.content }}
          </div>
        </div>
        <div *ngIf="msg.model" class="message-meta">{{ msg.model }}</div>
      </div>
      <div *ngIf="loading" class="message assistant">
        <div class="loading-indicator">
          <span></span>
          <span></span>
          <span></span>
        </div>
        <div class="loading-info">
          <small>
            Estimated: {{ estimatedTime }}s | Elapsed:
            {{ elapsedTime | number: '1.1-1' }}s
          </small>
        </div>
      </div>
    </div>

    <div class="input-area">
      <textarea
        [(ngModel)]="userPrompt"
        (keydown)="handleKeydown($event)"
        placeholder="Ask something about politics, funding, or policies... (Ctrl+Enter to send)"
        class="prompt-input"
        data-gramm="false"
        data-gramm-editor="false"
        data-enable-grammarly="false"
      ></textarea>
      <button
        (click)="sendMessage()"
        [disabled]="!selectedModel || !userPrompt.trim() || loading"
        class="btn-send"
      >
        Send
      </button>
      <p *ngIf="error" class="error-message">{{ error }}</p>
    </div>
  </div>
</div>
